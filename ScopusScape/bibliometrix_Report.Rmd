---
title: "Science Mapping Analysis with bibliometrix R-package: an example"
author: Massimo Aria and Corrado Cuccurullo
date: May 25, 2018
output:
  html_document:
    toc: yes
  html_notebook:
    theme: lumen
    toc: yes
  prettydoc::html_pretty:
    theme: hpstr
    highlight: github
editor_options: 
  chunk_output_type: console
---
# The collection

The collection is composed by all articles, letters, review and proceedings papers published on the Journal of Informetrics until 2017 (data collected in May, 2018).

**Data source**: Clarivate Analytics Web of Science (http://apps.webofknowledge.com)

**Data format**: Plaintext

**Timespan**:    2007-2017


# Install and load bibliometrix R-package
```{r load bibliometrix}
# Stable version from CRAN (Comprehensive R Archive Network)
# if you need to execute the code, remove # from the beginning of the next line

# install.packages("bibliometrix")


# Most updated version from GitHub
# if you need to execute the code, remove # from the beginning of the next lines

# install.packages("devtools")
# devtools::install_github("massimoaria/bibliometrix")

library(bibliometrix)
library(prettydoc)
library(rio)
library(tidyverse)
```


# Data Loading and Converting
```{r Data loading, warning=FALSE}
# Loading txt or bib files into R environment
# D <- readFiles('ScopusScape/scopusBib.bib')
# 
# # Converting the loaded files into a R bibliographic dataframe
# #M <- convert2df(D, dbsource="isi",format="plaintext")
# M <- scopus2df(D) 
# M <- M %>% filter(DT == 'ARTICLE'|DT == 'ARTICLE IN PRESS')

####### V3 With Standardized Searches
D <- readFiles('ScopusScape/scopusBib.bib')
Lakes <- readFiles('ScopusScape/lakesv3.bib') %>% scopus2df(.)
Rivers <- readFiles('ScopusScape/riversv3.bib') %>% scopus2df(.)
Estuary.Delta <- readFiles('ScopusScape/estdeltv3.bib') %>% scopus2df(.)
InlandWater <- readFiles('ScopusScape/case2v3.bib') %>% scopus2df(.)

M <- Lakes %>% full_join(Rivers) %>% full_join(Estuary.Delta) %>% full_join(InlandWater) %>% distinct(TI,AU, .keep_all = T)

#Clean the Journal Names a little big
### Look at the unique values in order
unique(M$SO)[order(unique(M$SO))]

M$SO <- M$SO %>% gsub(pattern = '^J GEOPHYS RES$', replacement = "JOURNAL OF GEOPHYSICAL RESEARCH", x = .) %>%
  gsub(pattern = '^LAKES AND RESERVOIRS: RESEARCH AND MANAGEMENT$', replacement = "LAKES & RESERVOIRS: RESEARCH AND MANAGEMENT", x = .) %>%
  gsub(pattern = '^PHOTOGRAMMETR\\. ENG\\. REMOTE SENS\\.$|^PHOTOGRAMMETR\\. ENGNG REMOTE SENS\\.$|^PHOTOGRAMMETRIC ENGINEERING & REMOTE SENSING$', replacement = "PHOTOGRAMMETRIC ENGINEERING AND REMOTE SENSING", x = .) %>%
  gsub(pattern = '^SCIENCE OF THE TOTAL ENVIRONMENT, THE$', replacement = "SCIENCE OF THE TOTAL ENVIRONMENT", x = .)

```

# Descriptive Analysis

## Main findings about the collection
```{r Descriptive Analysis, echo=TRUE, comment=NA}
#options(width=160)
results <- biblioAnalysis(M)
summ <- summary(results, k=10, pause=F, width=130)
plot(x=results, k=10, pause=F)
```

## Most Cited References
```{r Most cited references,  comment=NA}
CR <- citations(M, field = "article", sep = "; ")
cbind(CR$Cited[1:50])
```


# Network Analysis of main relational dimensions

## Co-citation Analysis: the Intellectual Structure of the field

**Plot options**:

* n = 50 (the funxtion plots the main 50 cited references)

* type = "fruchterman" (the network layout is generated using the Fruchterman-Reingold Algorithm)

* size.cex = TRUE (the size of the vertices is proportional to their degree)

* size = 20 (the max size of vertices)

* remove.multiple=FALSE (multiple edges are not removed)

* labelsize = 0.7 (defines the size of vertex labels)

* edgesize = 10 (The thickness of the edges is proportional to their strength. Edgesize defines the max value of the thickness)

* edges.min = 5 (plots only edges with a strength greater than or equal to 5)

* all other arguments assume the default values

```{r}
# Attempt to clean references first
M$CR <-  str_replace_all(pattern = ";\\s\\(\\d+\\)", string = M$CR, replacement = '; ')
# test2 <- test %>% str_split(pattern = '; ')
# check <- M$CR %>% str_split(pattern = '; ')
# grepl(pattern = '; \\( .*;', M$CR[15])
# 
# grepl(pattern = '; \\(\\d+\\).*;', M$CR[15])
# 
# test <- check[[15]][grep(pattern = '^\\(\\d+\\).*', x = check[[15]], invert = T)]
# test  
#   
# gsub(pattern = '^\\(\\d+\\).*', replacement = '', x = check[[15]])
# test
# test2 <- str_split(pattern = '; ', string = test)
# test2
# test3 <- sub(pattern = ';\\s\\(\\d.*;\\s', replacement = '; ', x =M$CR[15])
# test4 <- str_split(pattern = '; ', string = test3)
# test5 <- unite(test5)
# 
# M$CR[15]
# ?str_replace
# paste(test4, sep = '; ', collapse = '')
# test == M$CR[15]

## Clean the Journals

##Replace terms
for (i in 1:length(terms)) {
index.munge <- index.munge %>% mutate(Parameter = ifelse(grepl(pattern = terms[[i]], Parameter), names(terms[i]), as.character(Parameter)))
}
  
##Check the work
unique(index.munge$Parameter)[order(unique(index.munge$Parameter))]

check <- unique(unlist(check))

```



```{r Co-citation network, comment=NA, fig.height=10, fig.width=10}
NetMatrix <- biblioNetwork(M, analysis = "co-citation", network = "references", sep = ";")
png(filename='figures/CoCite.png', width=3.5,height=4, units='in', res=250)
net=networkPlot(NetMatrix, n = 40, Title = "Co-Citation Network", type = "fruchterman",vos.path = '/Applications/VOSviewer_1.6.8_jar', size.cex=TRUE, size=10, remove.multiple=T, labelsize=0.7,edgesize = 3, edges.min=5, label.n = 25)
dev.off()

NetMatrix <- biblioNetwork(M, analysis = "co-citation", network = "sources", sep = ";")

net=networkPlot(NetMatrix, n = 30, Title = "Co-Citation Network", type = "fruchterman",vos.path = '/Applications/VOSviewer_1.6.8_jar', size.cex=TRUE, size=10, remove.multiple=T, labelsize=0.7,edgesize = 3, edges.min=5, label.n = 25)

check <- M$JI %>% str_split(pattern = '; ', string = .)

M <- metaTagExtraction(M, Field = 'CR_JI', sep = ';')
authorsColab <- biblioNetwork(N, analysis = "co-citation", network = "authors", sep = ';') #"^; \\w$")
net=networkPlot(authorsColab, normalize = 'association', n = 50, Title = "Author Collaboration Network", type = "kamada", size.cex=TRUE, size=10, remove.multiple=T, labelsize=0.7,edgesize = 10, edges.min=5)
?networkPlot
```

Descriptive analysis of co-citation network characteristics
```{r Co-citation net stat, comment=NA}
netstat <- networkStat(net$graph)
summary(netstat,k=10)
```


## Keyword co-occurrences network

**Plot options**:

* normalize = "association" (the vertex similarities are normalized using association strength)

* n = 50 (the function plots the main 50 cited references)

* type = "fruchterman" (the network layout is generated using the Fruchterman-Reingold Algorithm)

* size.cex = TRUE (the size of the vertices is proportional to their degree)

* size = 20 (the max size of the vertices) 

* remove.multiple=FALSE (multiple edges are not removed)

* labelsize = 3 (defines the max size of vertex labels)

* label.cex = TRUE (The vertex label sizes are proportional to their degree)

* edgesize = 10 (The thickness of the edges is proportional to their strength. Edgesize defines the max value of the thickness)

* label.n = 30 (Labels are plotted only for the main 30 vertices)

* edges.min = 25 (plots only edges with a strength greater than or equal to 2)

* all other arguments assume the default values

```{r Keyword co-occurrences, comment=NA, fig.height=10, fig.width=10}
NetMatrix <- biblioNetwork(M, analysis = "co-citation", network = "references", sep = ";")

net=networkPlot(NetMatrix, normalize="association", n = 50, Title = "Keyword Co-occurrences", type = "kamada", size.cex=TRUE, size=20, remove.multiple=F, edgesize = 3, labelsize=3,label.cex=TRUE,label.n=30,edges.min=2)
```

Descriptive analysis of keyword co-occurrences network characteristics

```{r Keyword net stat, comment=NA}
netstat <- networkStat(NetMatrix)
summary(netstat,k=10)
```


## Author collaboration network
```{r, Au collaboration network, fig.height=10, fig.width=10}
NetMatrix <- biblioNetwork(M, analysis = "collaboration",  network = "authors", sep = ";")
net=networkPlot(NetMatrix,  n = 50, Title = "Author collaboration",type = "kamada", size=3,size.cex=T,edgesize = 1,labelsize=0.6, remove.isolates = T)
```

Descriptive analysis of author collaboration network characteristics

```{r Au coll stat, comment=NA}
netstat <- networkStat(NetMatrix)
summary(netstat,k=15)
```


## Edu collaboration network
```{r, Edu collaboration network, fig.height=10, fig.width=10}
M <- metaTagExtraction(M, Field = 'AU_UN', sep = ';')
NetMatrix <- biblioNetwork(M, analysis = "collaboration",  network = "universities", sep = ";")
net=networkPlot(NetMatrix,  n = 50, Title = "Edu collaboration",type = "auto", size=10,size.cex=T,edgesize = 3,labelsize=0.6)
```

Descriptive analysis of edu collaboration network characteristics

```{r Edu coll stat, comment=NA}
netstat <- networkStat(NetMatrix)
summary(netstat,k=15)
```


# Co-Word Analysis: The conceptual structure of the field
```{r Co-word Analysis, fig.height=10, fig.width=10}
CS <- conceptualStructure(M, method="CA", field="ID", minDegree=10, k.max = 8, stemming=f, labelsize=8,documents=20)
```


# Historiograph

```{r Direct citation network, fig.height=10, fig.width=10}
histResults <- histNetwork(M, sep = ";")

```

```{r Historiograph, comment=NA, fig.height=7,fig.width=10}
options(width = 130)
net <- histPlot(histResults, n=20, size.cex=TRUE, size = 5, labelsize = 3, arrowsize = 0.5)
```


# Thematic Map

```{r Keyword Network, include=FALSE}
NetMatrix <- biblioNetwork(M, analysis = "co-occurrences",network = "keywords", sep = ";")
S <- normalizeSimilarity(NetMatrix, type = "association")
net1 <- networkPlot(S, n=500, Title = "Keyword co-occurrences",type="fruchterman",
                   labelsize = 2, halo = F, cluster = "walktrap",remove.isolates=FALSE,
                   remove.multiple=FALSE, noloops=TRUE, weighted=TRUE,label.cex=T,edgesize=5, size=1,edges.min = 2)
```


```{r ThematicMap, echo=FALSE, fig.height=9, fig.width=9}

Map=thematicMap(net1, NetMatrix, S = S,minfreq=3)
plot(Map$map)
```
